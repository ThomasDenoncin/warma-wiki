---
import { factions } from '../../lib/const.mjs'

const armiesList = await Astro.glob('../../pages/*/*/index.astro')
const armiesTitles = armiesList.map(({title, description, tags}) => ({title, description, tags}))

const factionsString = JSON.stringify(factions)
const armiesListString = JSON.stringify(armiesTitles)
---
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Add unit</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <link rel="stylesheet" type="text/css" media="screen" href="main.css"> -->
    <link rel="stylesheet" type="text/css" media="screen" href="/css/unit.css">
  </head>
  <body>
    <header class="site-header">Warma-wiki</header>
    <main>
        <header>Add unit</header>
        <div class="form-wrapper">
            <form x-data="{
                faction: '',
                army: '',
                type: '',
                isLeader() {
                    return this.type === 'warlock' || this.type === 'warcaster'
                },
                get keywords() {
                    return this.faction + ' ' + this.army + ' ' + this.type
                }
            }">
                <div class="form-section">
                    <fieldset>
                        <legend>faction</legend>
                        <label for="faction">Faction</label>
                        <select 
                            name="faction"
                            x-data=`{factionList: ${factionsString}}`
                            x-model="faction"
                        >
                            <option value="">-</option>
                            <template x-for="faction in factionList">
                                <option 
                                    x-text="faction"
                                    x-bind:value="faction"
                                ></option>
                            </template> 
                        </select>
                        <label 
                            for="army"
                            x-show="faction"
                        >Army</label>
                        <select 
                            name="army"
                            x-show="faction"
                            x-data=`{
                                armyList: ${armiesListString},
                                factionArmyList: []
                            }`
                            x-effect="
                                factionArmyList = armyList.filter(army => (
                                    army.tags.includes(faction.toLowerCase())
                                ))
                            " 
                            x-model="army"
                        >
                            <template x-for="army in factionArmyList">
                                <option 
                                    x-text="army.title"
                                    x-bind:value="army.description"
                                ></option>
                            </template> 
                        </select>
                    </fieldset>
                </div>
                <div class="form-section">
                    <fieldset>
                        <legend>unit type</legend>
                        <input x-model="type" type="radio" name="type" id="warcaster" value="warcaster">
                        <label for="caster">Warcaster</label>
                        <input x-model="type" type="radio" name="type" id="warlock" value="warlock">
                        <label for="lock">Warlock</label>
                        <input x-model="type" type="radio" name="type" id="warjack" value="warjack">
                        <label for="jack">Warjack</label>
                        <input x-model="type" type="radio" name="type" id="warbeast" value="warbeast">
                        <label for="beast">Warbeast</label>
                        <input x-model="type" type="radio" name="type" id="solo" value="solo">
                        <label for="solo">Solo</label>
                        <input x-model="type" type="radio" name="type" id="unit" value="unit">
                        <label for="unit">Unit</label>
                        <input x-model="type" type="radio" name="type" id="attachment" value="attachment">
                        <label for="attach">Attachement</label>
                    </fieldset>
                </div>
                <div
                    class="form-section"
                    x-data="{fa: ''}"
                >
                    <fieldset>
                        <legend>unit infos</legend>
                        <label for="title">Title</label>
                        <input type="text" name="title" placeholder="Unit title">
                        <label for="name">Name</label>
                        <input type="text" name="name" placeholder="Unit name">
                        <label for="keywords">Keywords</label>
                        <input x-model="keywords" type="text" name="keywords" placeholder="Faction Army keywords">
                        <label for="fa">Field Allowance</label>
                        <input 
                            type="text" 
                            name="fa"
                            placeholder="Field Allowance"
                            x-text="fa"
                            x-model="fa"
                            x-effect="
                                fa = type && isLeader() ? 'C' : ''
                            "
                        >
                    </fieldset>
                </div>
                <div class="form-section">
                    <fieldset>
                        <legend>unit profile</legend>
                        <label for="spd">SPD</label>
                        <input type="number" pattern="\d*" name="spd" placeholder="Speed">
                        <label x-show="isLeader()" for="aat">AAT</label>
                        <input x-show="isLeader()" type="number" pattern="\d*" name="aat" placeholder="Arcane Attack">
                        <label for="mat">MAT</label>
                        <input type="number" pattern="\d*" name="mat" placeholder="Melee Attack">
                        <label for="rat">RAT</label>
                        <input type="number" pattern="\d*" name="rat" placeholder="Range Attack">
                        <label for="def">DEF</label>
                        <input type="number" pattern="\d*" name="def" placeholder="Defence">
                        <label for="arm">ARM</label>
                        <input type="number" pattern="\d*" name="arm" placeholder="Armor">
                        <label x-show="isLeader()" for="arc">ARC</label>
                        <input x-show="isLeader()" type="number" pattern="\d*" name="arc" placeholder="Arcane value">
                        <label x-show="isLeader()" for="ctrl">CTRL</label>
                        <input x-show="isLeader()" type="number" pattern="\d*" name="ctrl" placeholder="Controle Range">
                        <label for="hp">HP</label>
                        <input type="number" pattern="\d*" name="hp" placeholder="Health Points">
                        <label for="base">Base</label>
                        <input type="number" pattern="\d*" name="base" placeholder="Base size">
                        <label for="adv">Advantages</label>
                        <select name="adv"></select>
                    </fieldset>
                </div>
                <div class="form-section">
                    <fieldset>
                        <legend>unit abilities</legend>
                        <label for="abil">Abilities</label>
                        <select name="abil"></select>
                    </fieldset>
                </div>
                <div class="form-section">
                    <fieldset>
                        <legend>unit weapons</legend>
                        <label for="weapons">Weapons</label>
                        <select name="weapons"></select>
                    </fieldset>
                </div>
                <div class="form-section">
                    <fieldset>
                        <legend>unit feat</legend>
                        <label for="feat">Feat</label>
                        <select name="feat"></select>
                    </fieldset>
                </div>
                <div class="form-section">
                    <fieldset>
                        <legend>unit spells</legend>
                        <label for="spells">Spells</label>
                        <select name="spells"></select>
                    </fieldset>
                </div>
            </form>
        </div>
    </main>
  </body>
</html>

<style>
    header {
        padding: 30px;
        background-color: black;
        color: whitesmoke;
        font-size: 2em;
        font-weight: bolder;
        text-align: center;
    }

    nav {
        text-align: center;
    }

    article,
	.breadcrumbs {
        max-width: 800px;
        margin: 0 auto;
    }
	article {
		padding: 20px;
	}
	.breadcrumbs {
		padding: 20px 20px 0;
	}
</style>